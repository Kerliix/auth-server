<% layout('layouts/oauth') %>

<%
// Extract first name from user full name or email as fallback
const firstName = user && user.name 
  ? user.name.split(' ')[0] 
  : user && user.email 
    ? user.email.split('@')[0] 
    : 'User';

// Format scope to a readable list, e.g. "email, profile, openid"
const requestedScopes = scope ? scope.split(' ').join(', ') : '';
%>

<h2 class="mb-4">Authorize Application</h2>

<p>Hello <strong><%= firstName %></strong>,</p>

<p>
  <strong><%= client.name %></strong> is requesting access to your account and would like to access the following information:
</p>

<p><em><%= requestedScopes %></em></p>

<p>
  We will share only the information requested above with the client. 
  To learn more about how your data is used, please visit 
  <a href="/privacy" target="_blank" rel="noopener noreferrer">our data sharing policy</a>.
</p>

<form method="post" action="/oauth/authorize/decision" class="mt-4">
  <input type="hidden" name="transaction_id" value="<%= transactionID %>">
  <input type="hidden" name="scope" value="<%= scope %>">

  <div class="d-flex gap-3">
    <button type="submit" name="approve" value="1" class="btn btn-primary">Allow</button>
    <button type="submit" name="approve" value="0" class="btn btn-secondary">Deny</button>
  </div>
</form>
